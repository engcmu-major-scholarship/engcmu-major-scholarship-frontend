import { ReactNode, useEffect, useState } from 'react';
import {
  PathInfo,
  RolesBaseAccessContext,
} from '../contexts/RolesBaseAccessContext';
import { useAuth } from '../hooks/useAuth';
import { createCMUAccountSignInUrl } from '../utils/handleCMUAccountSignIn';
import { Path } from '../constants/Path';
import { Role } from '../types/Roles';

const basePaths: PathInfo[] = [
  {
    label: 'หน้าแรก',
    link: Path.HOME,
    icon: (
      <svg
        className="w-6 h-6 inline-block mr-2"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        // fill="white"
      >
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-1v-2h1v2zm0-4h-1V8h1v5z"></path>
      </svg>
    ),
  },
  {
    label: 'ทุนทั้งหมด',
    link: '',
    icon: (
      <svg
        width="60"
        height="54"
        viewBox="0 0 60 54"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M28.8487 0.997516C29.2108 0.835077 29.6031 0.751099 30 0.751099C30.3968 0.751099 30.7892 0.835077 31.1512 0.997516L58.3387 13.185C58.8329 13.4073 59.2524 13.7676 59.5467 14.2227C59.841 14.6777 59.9976 15.2081 59.9976 15.75C59.9976 16.2919 59.841 16.8223 59.5467 17.2773C59.2524 17.7324 58.8329 18.0927 58.3387 18.315L48.75 22.6163V33.0938C48.75 36.9338 45.7125 39.6525 42.525 41.2425C39.1762 42.9188 34.7437 43.875 30 43.875C28.9575 43.875 27.9375 43.83 26.94 43.74C26.2031 43.6662 25.5251 43.3048 25.0531 42.7341C24.5811 42.1635 24.3532 41.4297 24.4189 40.6921C24.4846 39.9545 24.8385 39.2726 25.4039 38.7943C25.9692 38.316 26.7004 38.08 27.4387 38.1375C28.2687 38.2125 29.1225 38.25 30 38.25C34.0575 38.25 37.5937 37.4213 40.0125 36.2138C42.6 34.92 43.125 33.6563 43.125 33.0938V25.1363L31.1512 30.5025C30.7892 30.665 30.3968 30.7489 30 30.7489C29.6031 30.7489 29.2108 30.665 28.8487 30.5025L15 24.3V30.5363C16.11 30.93 17.1562 31.5675 18.045 32.4563C19.6875 34.0988 20.625 36.4275 20.625 39.1913V50.4413C20.625 51.1872 20.3287 51.9026 19.8012 52.43C19.2738 52.9575 18.5584 53.2538 17.8125 53.2538H6.56247C5.81655 53.2538 5.10118 52.9575 4.57373 52.43C4.04629 51.9026 3.74997 51.1872 3.74997 50.4413V39.1913C3.74997 36.4275 4.68747 34.0988 6.32997 32.4563C7.21872 31.5675 8.26497 30.93 9.37497 30.5363V21.7725L1.66122 18.315C1.167 18.0927 0.747513 17.7324 0.453226 17.2773C0.158939 16.8223 0.00238037 16.2919 0.00238037 15.75C0.00238037 15.2081 0.158939 14.6777 0.453226 14.2227C0.747513 13.7676 1.167 13.4073 1.66122 13.185L28.8487 0.997516ZM9.68622 15.75L30 24.855L50.31 15.75L30 6.64502L9.68622 15.75ZM9.37497 39.1875V47.625H15V39.1875C15 37.7325 14.5312 36.8963 14.0625 36.4313C13.8159 36.1866 13.5231 35.9934 13.2013 35.8627C12.8794 35.732 12.5348 35.6665 12.1875 35.67C11.8401 35.6665 11.4955 35.732 11.1737 35.8627C10.8518 35.9934 10.5591 36.1866 10.3125 36.4313C9.84372 36.8963 9.37497 37.7325 9.37497 39.1875Z"
          fill="black"
        />
      </svg>
    ),
  },
];

const notLoggedInPaths: PathInfo[] = [
  {
    label: 'เข้าสู่ระบบ',
    link: createCMUAccountSignInUrl(),
    icon: (
      <svg
        className="w-6 h-6 inline-block mr-2"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        // fill="white"
      >
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-1v-2h1v2zm0-4h-1V8h1v5z"></path>
      </svg>
    ),
  },
];

const studentPaths: PathInfo[] = [
  {
    label: 'สมัครทุน',
    link: '',
    icon: (
      <svg
        width="40"
        height="50"
        viewBox="0 0 40 50"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M25.625 1.25C25.625 1.08424 25.5592 0.925269 25.4419 0.808058C25.3247 0.690848 25.1658 0.625 25 0.625H7.5C5.67664 0.625 3.92795 1.34933 2.63864 2.63864C1.34933 3.92795 0.625 5.67664 0.625 7.5V42.5C0.625 44.3234 1.34933 46.072 2.63864 47.3614C3.92795 48.6507 5.67664 49.375 7.5 49.375H32.5C34.3234 49.375 36.072 48.6507 37.3614 47.3614C38.6507 46.072 39.375 44.3234 39.375 42.5V17.8675C39.375 17.7017 39.3092 17.5428 39.1919 17.4256C39.0747 17.3083 38.9158 17.2425 38.75 17.2425H27.5C27.0027 17.2425 26.5258 17.045 26.1742 16.6933C25.8225 16.3417 25.625 15.8648 25.625 15.3675V1.25ZM27.5 25.625C27.9973 25.625 28.4742 25.8225 28.8258 26.1742C29.1775 26.5258 29.375 27.0027 29.375 27.5C29.375 27.9973 29.1775 28.4742 28.8258 28.8258C28.4742 29.1775 27.9973 29.375 27.5 29.375H12.5C12.0027 29.375 11.5258 29.1775 11.1742 28.8258C10.8225 28.4742 10.625 27.9973 10.625 27.5C10.625 27.0027 10.8225 26.5258 11.1742 26.1742C11.5258 25.8225 12.0027 25.625 12.5 25.625H27.5ZM27.5 35.625C27.9973 35.625 28.4742 35.8225 28.8258 36.1742C29.1775 36.5258 29.375 37.0027 29.375 37.5C29.375 37.9973 29.1775 38.4742 28.8258 38.8258C28.4742 39.1775 27.9973 39.375 27.5 39.375H12.5C12.0027 39.375 11.5258 39.1775 11.1742 38.8258C10.8225 38.4742 10.625 37.9973 10.625 37.5C10.625 37.0027 10.8225 36.5258 11.1742 36.1742C11.5258 35.8225 12.0027 35.625 12.5 35.625H27.5Z"
          fill="black"
        />
      </svg>
    ),
  },
  {
    label: 'ตรวจสอบสถานะ',
    link: '',
    icon: (
      <svg
        width="50"
        height="50"
        viewBox="0 0 50 50"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M25 0C26.39 0 27.75 0.11 29.08 0.33L24.4 5.01C20.4985 5.12708 16.7164 6.38326 13.5202 8.62371C10.3239 10.8641 7.85307 13.9909 6.41228 17.6186C4.97149 21.2462 4.62371 25.2162 5.41181 29.0391C6.1999 32.862 8.08944 36.3708 10.8475 39.1328C13.6055 41.8949 17.1115 43.7895 20.9333 44.5832C24.755 45.3769 28.7255 45.0349 32.3553 43.5993C35.985 42.1638 39.1154 39.6976 41.3605 36.5046C43.6056 33.3116 44.8673 29.5314 44.99 25.63L49.675 20.95C49.8917 22.2667 50 23.6167 50 25C50 29.9445 48.5338 34.778 45.7867 38.8893C43.0397 43.0005 39.1353 46.2048 34.5671 48.097C29.9989 49.9892 24.9723 50.4843 20.1228 49.5196C15.2732 48.555 10.8187 46.174 7.32234 42.6777C3.82603 39.1814 1.44501 34.7268 0.480379 29.8773C-0.484251 25.0277 0.0108321 20.0011 1.90302 15.4329C3.79521 10.8648 6.99953 6.96029 11.1108 4.21326C15.222 1.46622 20.0555 0 25 0ZM47.205 2.81C46.3163 1.9212 45.2613 1.21615 44.1001 0.735128C42.9389 0.254105 41.6944 0.00652373 40.4375 0.00652373C39.1806 0.00652373 37.9361 0.254105 36.7749 0.735128C35.6137 1.21615 34.5587 1.9212 33.67 2.81L20.75 15.73C20.4779 16.0028 20.2726 16.3348 20.15 16.7L15.23 31.3C15.0667 31.785 15.042 32.306 15.1586 32.8043C15.2753 33.3026 15.5287 33.7585 15.8903 34.1206C16.2519 34.4828 16.7074 34.7368 17.2056 34.8542C17.7037 34.9716 18.2247 34.9476 18.71 34.785L33.31 29.875C33.677 29.7531 34.0108 29.5477 34.285 29.275L47.205 16.35C48.0938 15.4613 48.7989 14.4063 49.2799 13.2451C49.7609 12.0839 50.0085 10.8394 50.0085 9.5825C50.0085 8.32563 49.7609 7.08108 49.2799 5.9199C48.7989 4.75872 48.0938 3.69867 47.205 2.81Z"
          fill="black"
        />
      </svg>
    ),
  },
  {
    label: 'ประวัติการสมัคร',
    link: '',
    icon: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        shape-rendering="geometricPrecision"
        text-rendering="geometricPrecision"
        image-rendering="optimizeQuality"
        fill-rule="evenodd"
        clip-rule="evenodd"
        viewBox="0 0 512 513.11"
      >
        <path
          fill-rule="nonzero"
          d="M210.48 160.8c0-14.61 11.84-26.46 26.45-26.46s26.45 11.85 26.45 26.46v110.88l73.34 32.24c13.36 5.88 19.42 21.47 13.54 34.82-5.88 13.35-21.47 19.41-34.82 13.54l-87.8-38.6c-10.03-3.76-17.16-13.43-17.16-24.77V160.8zM5.4 168.54c-.76-2.25-1.23-4.64-1.36-7.13l-4-73.49c-.75-14.55 10.45-26.95 25-27.69 14.55-.75 26.95 10.45 27.69 25l.74 13.6a254.258 254.258 0 0136.81-38.32c17.97-15.16 38.38-28.09 61.01-38.18 64.67-28.85 134.85-28.78 196.02-5.35 60.55 23.2 112.36 69.27 141.4 132.83.77 1.38 1.42 2.84 1.94 4.36 27.86 64.06 27.53 133.33 4.37 193.81-23.2 60.55-69.27 112.36-132.83 141.39a26.24 26.24 0 01-12.89 3.35c-14.61 0-26.45-11.84-26.45-26.45 0-11.5 7.34-21.28 17.59-24.92 7.69-3.53 15.06-7.47 22.09-11.8.8-.66 1.65-1.28 2.55-1.86 11.33-7.32 22.1-15.7 31.84-25.04.64-.61 1.31-1.19 2-1.72 20.66-20.5 36.48-45.06 46.71-71.76 18.66-48.7 18.77-104.46-4.1-155.72l-.01-.03C418.65 122.16 377.13 85 328.5 66.37c-48.7-18.65-104.46-18.76-155.72 4.1a203.616 203.616 0 00-48.4 30.33c-9.86 8.32-18.8 17.46-26.75 27.29l3.45-.43c14.49-1.77 27.68 8.55 29.45 23.04 1.77 14.49-8.55 27.68-23.04 29.45l-73.06 9c-13.66 1.66-26.16-7.41-29.03-20.61zM283.49 511.5c20.88-2.34 30.84-26.93 17.46-43.16-5.71-6.93-14.39-10.34-23.29-9.42-15.56 1.75-31.13 1.72-46.68-.13-9.34-1.11-18.45 2.72-24.19 10.17-12.36 16.43-2.55 39.77 17.82 42.35 19.58 2.34 39.28 2.39 58.88.19zm-168.74-40.67c7.92 5.26 17.77 5.86 26.32 1.74 18.29-9.06 19.97-34.41 3.01-45.76-12.81-8.45-25.14-18.96-35.61-30.16-9.58-10.2-25.28-11.25-36.11-2.39a26.436 26.436 0 00-2.55 38.5c13.34 14.2 28.66 27.34 44.94 38.07zM10.93 331.97c2.92 9.44 10.72 16.32 20.41 18.18 19.54 3.63 36.01-14.84 30.13-33.82-4.66-15-7.49-30.26-8.64-45.93-1.36-18.33-20.21-29.62-37.06-22.33C5.5 252.72-.69 262.86.06 274.14c1.42 19.66 5.02 39 10.87 57.83z"
        />
      </svg>
    ),
  },
];

const advisorPaths: PathInfo[] = [];

const adminPaths: PathInfo[] = [];

const RolesBaseAccessProvider = ({ children }: { children: ReactNode }) => {
  const { token, roles } = useAuth();
  const [accessibles, setAccessibles] = useState<PathInfo[]>([]);

  useEffect(() => {
    if (!token) {
      setAccessibles([...basePaths, ...notLoggedInPaths]);
    } else {
      const allowedPaths: PathInfo[] = [];
      if (roles.includes(Role.STUDENT)) {
        allowedPaths.push(...studentPaths);
      }
      if (roles.includes(Role.ADVISOR)) {
        allowedPaths.push(...advisorPaths);
      }
      if (roles.includes(Role.ADMIN)) {
        allowedPaths.push(...adminPaths);
      }
      setAccessibles([...basePaths, ...allowedPaths]);
    }
  }, [token, roles]);

  return (
    <RolesBaseAccessContext.Provider value={{ accessibles, setAccessibles }}>
      {children}
    </RolesBaseAccessContext.Provider>
  );
};

export default RolesBaseAccessProvider;
